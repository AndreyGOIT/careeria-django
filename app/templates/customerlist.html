{% extends "index.html" %} {% block content %}

<br />
<div id="add-div"></div>
<br />

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="display-5 fw-bold" style="color: #025930">Customers</h1>
  <button id="add-btn" class="btn btn-success btn-lg" onclick="showaddform()">
    <i class="bi bi-plus-circle"></i> Add New Customer
  </button>
</div>

<!-- Search Form -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <form
      method="post"
      action="/search-customers/"
      class="row g-3 align-items-center"
    >
      {% csrf_token %}
      <div class="col-md-8">
        <input
          class="form-control form-control-lg"
          type="text"
          placeholder="Search customers by company name..."
          name="search"
        />
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-outline-primary btn-lg w-100">
          <i class="bi bi-search"></i> Search
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Customers List -->
<div class="row">
  {% for c in customers %}
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card h-100 shadow-sm border-0 customer-card">
      <div class="card-header bg-transparent border-0">
        <h5 class="card-title fw-bold text-primary mb-0">{{c.companyname}}</h5>
      </div>
      <div class="card-body">
        <div class="customer-info mb-3">
          <div class="d-flex align-items-center mb-2">
            <i class="bi bi-person me-2 text-secondary"></i>
            <span class="text-muted">{{c.contactname}}</span>
          </div>
          <div class="d-flex align-items-center mb-2">
            <i class="bi bi-envelope me-2 text-secondary"></i>
            <span class="text-muted">{{c.contactemail}}</span>
          </div>
          <div class="d-flex align-items-center mb-2">
            <i class="bi bi-telephone me-2 text-secondary"></i>
            <span class="text-muted">{{c.phone|default:"Not provided"}}</span>
          </div>
          <div class="d-flex align-items-center mb-2">
            <i class="bi bi-geo-alt me-2 text-secondary"></i>
            <span class="text-muted">{{c.address|default:"Not provided"}}</span>
          </div>
        </div>
      </div>
      <div class="card-footer bg-transparent border-0 pt-0">
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <a
            href="/edit-customer-get/{{c.id}}/"
            class="btn btn-outline-primary btn-sm me-md-2"
          >
            <i class="bi bi-pencil"></i> Edit
          </a>
          <a
            href="/confirm-delete-customer/{{c.id}}/"
            class="btn btn-outline-danger btn-sm me-md-2"
          >
            <i class="bi bi-trash"></i> Delete
          </a>
          <a
            href="/orders-by-customer/{{c.id}}/"
            class="btn btn-outline-secondary btn-sm"
          >
            <i class="bi bi-list-ul"></i> Orders
          </a>
        </div>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-body text-center py-5">
        <i class="bi bi-people display-1 text-muted"></i>
        <h3 class="text-muted mt-3">No customers found</h3>
        <p class="text-muted">Start by adding your first customer</p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Add Customer Form Template -->
<script>
  let x = `
    <div class="card shadow-lg border-0 mb-4">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0"><i class="bi bi-person-plus"></i> Add New Customer</h3>
        </div>
        <div class="card-body">
            <form method="post" action="/add-customer/" class="row g-3">
                {% csrf_token %}
                <div class="col-md-6">
                    <label class="form-label fw-bold">Company Name *</label>
                    <input class="form-control" type="text" placeholder="Company name" name="companyname" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">Contact Person *</label>
                    <input class="form-control" type="text" placeholder="Contact name" name="contactname" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">Email *</label>
                    <input class="form-control" type="email" placeholder="email@example.com" name="email" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Phone</label>
                    <input class="form-control" type="tel" placeholder="+358 12 345 6789" name="phone">
                </div>
                <div class="col-12">
                    <label class="form-label">Address</label>
                    <textarea class="form-control" placeholder="Full address" name="address" rows="2"></textarea>
                </div>
                <div class="col-12">
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-circle"></i> Confirm
                        </button>
                        <button type="button" onclick="hideaddform()" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    `;

  function showaddform() {
    document.getElementById("add-div").innerHTML = x;
    document.getElementById("add-btn").style.display = "none";
    // Плавная прокрутка к форме
    document.getElementById("add-div").scrollIntoView({ behavior: "smooth" });
  }

  function hideaddform() {
    document.getElementById("add-div").innerHTML = "";
    document.getElementById("add-btn").style.display = "inline-block";
  }
</script>

<!-- Additional CSS -->
<style>
  .customer-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border-radius: 12px;
  }

  .customer-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1) !important;
  }

  .customer-info span {
    font-size: 0.95rem;
  }

  .btn {
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .btn:hover {
    transform: translateY(-1px);
  }

  .card {
    border-radius: 12px;
  }
</style>

<!-- Bootstrap Icons -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
/>

{% endblock %}
